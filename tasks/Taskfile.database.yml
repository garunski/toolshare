version: '3'

tasks:
  # ============================================================================
  # SUPABASE DATABASE TASKS
  # ============================================================================

  supabase-start:
    desc: Start Supabase services locally
    cmds:
      - |
        echo "ğŸš€ Starting Supabase..."
        supabase start --exclude vector
        echo "âœ… Supabase started"
        echo "ğŸ“Š Studio: http://localhost:54323"
        echo "ğŸ”— API: http://localhost:54321"

  supabase-stop:
    desc: Stop Supabase services
    cmds:
      - |
        echo "ğŸ›‘ Stopping Supabase..."
        supabase stop
        echo "âœ… Supabase stopped"

  supabase-status:
    desc: Check Supabase service status
    cmds:
      - |
        echo "ğŸ“Š Supabase Status:"
        supabase status

  supabase-reset:
    desc: "Reset Supabase database (WARNING: This will delete all data)"
    cmds:
      - |
        echo "âš ï¸  Resetting Supabase database..."
        echo "This will delete all data. Are you sure? (y/N)"
        read -r response
        if [[ "$response" =~ ^[Yy]$ ]]; then
          supabase db reset
          echo "âœ… Database reset complete"
        else
          echo "âŒ Database reset cancelled"
        fi

  db-migrate:
    desc: Apply database migrations
    cmds:
      - |
        echo "ğŸ”„ Applying database migrations..."
        supabase db push
        echo "âœ… Migrations applied"

  db-migrate-new:
    desc: Create a new migration file
    cmds:
      - |
        echo "ğŸ“ Creating new migration..."
        echo "Enter migration name:"
        read -r migration_name
        supabase migration new "$migration_name"

  db-seed:
    desc: Seed the database with initial data
    cmds:
      - |
        echo "ğŸŒ± Seeding database..."
        supabase db reset --seed
        echo "âœ… Database seeded"

  db-seed-users:
    desc: Create test users and sample data
    cmds:
      - |
        echo "ğŸ‘¥ Creating test users..."
        node supabase/seed-users.ts
        echo "ğŸ“¦ Creating sample data..."
        node supabase/seed-data.ts
        echo "âœ… Test data creation complete!"

  db-types:
    desc: Generate TypeScript types from database schema
    cmds:
      - |
        echo "ğŸ“ Generating TypeScript types..."
        supabase gen types typescript --local > src/type/supabase.ts
        echo "âœ… Types generated at src/type/supabase.ts"

  logs:
    desc: Show Supabase logs
    cmds:
      - |
        echo "ğŸ“‹ Supabase logs:"
        supabase logs

  studio:
    desc: Open Supabase Studio in browser
    cmds:
      - |
        echo "ğŸŒ Opening Supabase Studio..."
        open http://localhost:54323 