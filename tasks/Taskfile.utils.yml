version: '3'

tasks:
  # ============================================================================
  # CLEANUP TASKS
  # ============================================================================

  clean:
    desc: Clean build artifacts and temporary files
    cmds:
      - |
        echo "üßπ Cleaning project..."
        rm -rf .next
        rm -rf node_modules/.cache
        rm -rf .turbo
        echo "‚úÖ Clean complete"

  clean-all:
    desc: Clean everything including node_modules (requires reinstall)
    cmds:
      - |
        echo "üßπ Deep cleaning project..."
        rm -rf .next
        rm -rf node_modules
        rm -rf .turbo
        echo "‚úÖ Deep clean complete"
        echo "‚ö†Ô∏è  Run 'task install-deps' to reinstall dependencies"

  # ============================================================================
  # MONITORING & DEBUGGING
  # ============================================================================

  monitor:
    desc: Monitor all services and show status
    cmds:
      - |
        echo "üìä Service Monitoring"
        echo "===================="
        echo ""
        echo "üîç Checking Next.js..."
        if curl -s http://localhost:3000 > /dev/null; then
          echo "‚úÖ Next.js running"
        else
          echo "‚ùå Next.js not running"
        fi
        echo ""
        echo "üîç Checking Supabase API..."
        if curl -s http://localhost:54321/rest/v1/ > /dev/null; then
          echo "‚úÖ Supabase API running"
        else
          echo "‚ùå Supabase API not running"
        fi
        echo ""
        echo "üîç Checking Supabase Studio..."
        if curl -s http://localhost:54323 > /dev/null; then
          echo "‚úÖ Supabase Studio running"
        else
          echo "‚ùå Supabase Studio not running"
        fi

  debug-env:
    desc: Debug environment variables (without exposing secrets)
    cmds:
      - |
        echo "üîç Environment Debug Info"
        echo "========================="
        echo "NODE_ENV: $NODE_ENV"
        echo "NEXT_PUBLIC_SUPABASE_URL: ${NEXT_PUBLIC_SUPABASE_URL:-not set}"
        echo "NEXT_PUBLIC_SUPABASE_ANON_KEY: ${NEXT_PUBLIC_SUPABASE_ANON_KEY:-not set}"
        echo "NOVU_API_KEY: ${NOVU_API_KEY:-not set}"
        echo "NEXT_PUBLIC_NOVU_APP_ID: ${NEXT_PUBLIC_NOVU_APP_ID:-not set}"

  docker-fix-auth:
    desc: Fix Docker authentication issues (standalone task)
    cmds:
      - |
        echo "üîß Fixing Docker authentication issues..."
        echo "Logging out from public.ecr.aws to clear expired tokens..."
        docker logout public.ecr.aws || true
        echo "‚úÖ Docker authentication reset"
        echo ""
        echo "üîÑ Now try starting Supabase again:"
        echo "  task database:supabase-start"
        echo ""
        echo "üí° If issues persist, you may need to:"
        echo "  docker login public.ecr.aws"

  clear-task-cache:
    desc: Clear Task runner cache
    cmds:
      - |
        echo "üßπ Clearing Task cache..."
        rm -rf .task
        echo "‚úÖ Task cache cleared"
        echo "üí° Run 'task dev' again to start development" 