version: '3'

tasks:
  # ============================================================================
  # PROJECT SETUP & INITIALIZATION
  # ============================================================================

  install-deps:
    desc: Install all project dependencies
    cmds:
      - |
        echo "ğŸ“¦ Installing dependencies..."
        npm install
        echo "âœ… Dependencies installed successfully"

  setup-env:
    desc: Set up environment variables
    cmds:
      - |
        echo "ğŸ”§ Setting up environment variables..."
        if [ ! -f .env.local ]; then
          cp env.example .env.local
          echo "ğŸ“ Created .env.local from env.example"
          echo "âš ï¸  Please update .env.local with your actual values"
        else
          echo "âœ… .env.local already exists"
        fi

  setup-supabase:
    desc: Initialize and start Supabase locally
    deps: [install-supabase-cli]
    cmds:
      - |
        echo "ğŸš€ Setting up Supabase..."
        supabase start --exclude vector
        echo "âœ… Supabase started successfully"
        echo "ğŸ“Š Studio available at: http://localhost:54323"
        echo "ğŸ”— API available at: http://localhost:54321"

  install-supabase-cli:
    desc: Install Supabase CLI if not already installed
    cmds:
      - |
        if ! command -v supabase &> /dev/null; then
          echo "ğŸ“¥ Installing Supabase CLI..."
          if [[ "$OSTYPE" == "darwin"* ]]; then
            brew install supabase/tap/supabase
          elif [[ "$OSTYPE" == "linux-gnu"* ]]; then
            curl -fsSL https://supabase.com/install.sh | sh
          else
            echo "âŒ Unsupported OS. Please install Supabase CLI manually: https://supabase.com/docs/guides/cli"
            exit 1
          fi
        else
          echo "âœ… Supabase CLI already installed"
        fi

  fix-docker-auth:
    desc: Fix Docker authentication issues for Supabase
    cmds:
      - |
        echo "ğŸ”§ Fixing Docker authentication..."
        echo "Logging out from public.ecr.aws to clear expired tokens..."
        docker logout public.ecr.aws || true
        echo "âœ… Docker authentication reset"
        echo "ğŸ’¡ If Supabase still fails, try: docker login public.ecr.aws" 